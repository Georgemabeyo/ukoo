<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function() {
  function doSearch(query) {
    if(query.length < 2) {
      $("#searchResults").empty();
      return;
    }
    $.getJSON('search.php', { q: query }, function(results) {
      let html = '<ul>';
      if(results.length === 0) {
        html += '<li>Hakuna matokeo</li>';
      } else {
        results.forEach(person => {
          html += `<li>
            <a href="#" class="person-name" data-id="${person.id}" data-parent-id="${person.parent_id}">${person.full_name}</a>
            <div class="child-of-parent" id="parent-${person.id}"></div>
          </li>`;
        });
      }
      html += '</ul>';
      $("#searchResults").html(html);
    });
  }

  // Search on input
  $('#searchInput').on('input', function() {
    doSearch($(this).val());
  });

  // Click handler to expand parent's info
  $(document).on('click', '.person-name', function(e) {
    e.preventDefault();
    let personId = $(this).data('id');
    let parentId = $(this).data('parent-id');
    let container = $('#parent-' + personId);

    // Toggle display
    if(container.is(':visible')) {
      container.slideUp();
      return;
    }

    if(!parentId) {
      container.html('<em>Mzazi hayupo katika mfumo.</em>').slideDown();
      return;
    }

    // Fetch parent and siblings (uzao wa mzazi) info
    $.get('parent_family.php', { id: parentId }, function(html){
      container.html(html).slideDown();
    });
  });
});
</script>
